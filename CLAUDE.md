# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Development Commands

```bash
# Development
npm run dev      # Start development server on port 4000
npm run build    # Create production build
npm run start    # Start production server
npm run lint     # Run ESLint for code linting

# Access the application at http://localhost:4000
```

## Architecture Overview

This is a **Next.js 14 App Router** CRM/ERP system called "Spikes" for contract management, lead tracking, and financial operations. Key architectural patterns:

### Framework & Core Technologies
- **Next.js 14.2.13** with App Router (file-based routing)
- **React 18** with functional components and hooks
- **Tailwind CSS 3.4.1** for styling with custom CSS variables
- **JWT authentication** using `jose` library with cookie-based sessions
- **No external state management** - uses React Context and local state

### Authentication Flow
- JWT tokens stored in `factura-token` cookies (24-hour expiration)
- Middleware protection in `/middleware.js` for all protected routes
- Three-tier access control: Regular users, Managers (`isManager: true`), Super Admin (`groupId === 1`)
- Login redirects to `/contratos` by default

### API Communication Pattern
All API calls abstracted through `/helpers/server-fetch.helper.js`:
- `postFetch()` / `getFetch()` - Unauthenticated requests
- `authFetch()` / `authGetFetch()` - Authenticated requests with Bearer token
- `authFetchFormData()` - File uploads with authentication
- Uses `NEXT_PUBLIC_API_URL` environment variable

### Directory Structure & Components
```
/app/                    # Next.js App Router pages
├── api/auth/login/      # Authentication endpoint
├── [feature]/page.js    # Feature pages (contracts, campaigns, etc.)
├── layout.js           # Root layout with sidebar navigation
└── page.js             # Login page

/components/            # Reusable React components
├── [feature].form.js   # Form components
├── [feature].modal.js  # Modal components
├── [feature].section.js # Section components
└── drive/              # File management components

/helpers/               # Utility functions
├── server-fetch.helper.js # API communication
├── notification.helper.js # Toast notifications
├── dates.helper.js        # Date formatting
├── strings.helper.js      # String manipulation
└── validation.helper.js   # Form validation

/hooks/                 # Custom React hooks
└── useIsMobile.js      # Responsive detection
```

### State Management Strategy
- **Component State**: `useState` for local component data
- **Layout Context**: Global sidebar visibility state
- **Cookie State**: Authentication tokens and user session data
- **No Redux or Zustand** - keeps state management simple

### Permission-Based Navigation
The sidebar dynamically shows/hides menu items based on user permissions:
- **Regular users**: Contracts, Personal Agenda, Lead Manager, Tools, Drive, Liquidations
- **Managers**: + User management, some configuration options
- **Super Admin** (`groupId === 1`): + All configuration options (Companies, Channels, States, Origins, Campaign management, Invoice generation)

### Business Domain Context
Key entities and Spanish terminology used throughout:
- **Contratos**: Contracts (main business entity)
- **Liquidaciones**: Financial settlements/liquidations
- **Leads**: Potential customers in sales pipeline
- **Campañas**: Marketing campaigns
- **Canales**: Distribution/communication channels
- **Estados**: Status of contracts/leads
- **Origins**: Lead source origins
- **Justo Título**: Legal ownership documents generated by system
- **Companies**: Business entities that can have contracts

### Code Standards
- **File naming**: kebab-case with type suffix (e.g., `contract-details.modal.js`)
- **Component naming**: PascalCase (e.g., `ContractDetailsModal`)
- **CSS**: Tailwind utilities + custom CSS variables in `globals.css`
- **API endpoints**: Follow REST conventions with kebab-case
- **Path aliases**: `@/` maps to project root via `jsconfig.json`

### Important Configuration Notes
- React Strict Mode is **disabled** in `next.config.mjs`
- Custom Tailwind color variables defined for theming
- Geist font family loaded locally
- No testing framework currently implemented
- Spanish locale used throughout the application ("es")

### Environment Variables Required
```bash
NEXT_PUBLIC_API_URL=http://localhost:3000    # Public API endpoint
API_URL=http://localhost:3000                # Server-side API endpoint  
NEXT_PUBLIC_URL_CONTRACT=http://localhost:4000  # Contract service endpoint
JWT_SECRET=your_jwt_secret_here              # JWT token signing secret
NODE_ENV=development                         # Environment mode
```

### Route Protection Patterns
Routes are protected via middleware with these access levels:
1. **Public**: `/` (login page only)
2. **Authenticated**: Most routes require valid JWT
3. **Manager-only**: `/usuarios` requires `isManager: true`
4. **Super Admin-only**: Configuration routes require `groupId === 1`

### Document Generation Features
The system includes PDF generation capabilities:
- **@react-pdf/renderer**: For generating invoices and documents
- **jspdf**: Additional PDF manipulation
- **xlsx**: Excel export functionality
- **html2canvas**: Screenshot/image capture for documents

This codebase prioritizes simplicity and follows Next.js conventions closely, making it straightforward to extend with new features while maintaining the existing architectural patterns.